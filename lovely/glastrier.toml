[manifest]
version = "1.0.0"
dump_lua = true
priority = 0

## Welcome to my Sisyphean Hellscape.
## John SMODS please add a standardized way to do this
##   (If you're reading this to try to implement your own,
##    there are additional hooks in `src/functions/effects.lua`)

# SMODS.calculate_destroying_cards
[[patches]]
[patches.pattern]
target = '=[SMODS _ "src/utils.lua"]'
position = "after"
match_indent = true
pattern = '''-- TARGET: card destroyed'''
payload = '''
if destroyed and AG.effects.prevent_destruction(card) then
  destroyed = false
end
'''

# G.FUNCS.discard_cards_from_highlighted
[[patches]]
[patches.pattern]
target = 'functions/state_events.lua'
position = "after"
match_indent = true
pattern = '''if key == 'remove' or (type(eval2) == 'table' and eval2.remove) then removed = true end'''
payload = '''if removed and AG.effects.prevent_destruction(G.hand.highlighted[i]) then removed = false end'''
